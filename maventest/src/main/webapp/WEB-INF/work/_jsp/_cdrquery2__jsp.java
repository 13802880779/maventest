/*
 * JSP generated by Resin Professional 4.0.48 (built Wed, 17 Feb 2016 11:03:24 PST)
 */

package _jsp;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;

public class _cdrquery2__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;
  private boolean _caucho_isNotModified;
  private com.caucho.jsp.PageManager _jsp_pageManager;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    com.caucho.jsp.PageContextImpl pageContext = _jsp_pageManager.allocatePageContext(this, _jsp_application, request, response, null, null, 8192, true, false);

    TagState _jsp_state = null;

    try {
      _jspService(request, response, pageContext, _jsp_application, _jsp_state);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_pageManager.freePageContext(pageContext);
    }
  }
  
  private void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response,
              com.caucho.jsp.PageContextImpl pageContext,
              javax.servlet.ServletContext application,
              TagState _jsp_state)
    throws Throwable
  {
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    javax.servlet.jsp.tagext.JspTag _jsp_parent_tag = null;
    com.caucho.jsp.PageContextImpl _jsp_parentContext = pageContext;
    response.setContentType("text/html");
    response.setCharacterEncoding("utf-8");

    out.write(_jsp_string0, 0, _jsp_string0.length);
    out.write(_jsp_string1, 0, _jsp_string1.length);
    out.write(_jsp_string2, 0, _jsp_string2.length);
  }

  private com.caucho.make.DependencyContainer _caucho_depends
    = new com.caucho.make.DependencyContainer();

  public java.util.ArrayList<com.caucho.vfs.Dependency> _caucho_getDependList()
  {
    return _caucho_depends.getDependencies();
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    _caucho_depends.add(depend);
  }

  protected void _caucho_setNeverModified(boolean isNotModified)
  {
    _caucho_isNotModified = true;
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;

    if (_caucho_isNotModified)
      return false;

    if (com.caucho.server.util.CauchoSystem.getVersionId() != -8002497470487589159L)
      return true;

    return _caucho_depends.isModified();
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
    TagState tagState;
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("cdrquery2.jsp"), 1150017778461967919L, false);
    _caucho_depends.add(depend);
    loader.addDependency(depend);
  }

  final static class TagState {

    void release()
    {
    }
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void caucho_init(ServletConfig config)
  {
    try {
      com.caucho.server.webapp.WebApp webApp
        = (com.caucho.server.webapp.WebApp) config.getServletContext();
      init(config);
      if (com.caucho.jsp.JspManager.getCheckInterval() >= 0)
        _caucho_depends.setCheckInterval(com.caucho.jsp.JspManager.getCheckInterval());
      _jsp_pageManager = webApp.getJspApplicationContext().getPageManager();
      com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
      com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.InitPageContextImpl(webApp, this);
    } catch (Exception e) {
      throw com.caucho.config.ConfigException.create(e);
    }
  }

  private final static char []_jsp_string0;
  private final static char []_jsp_string1;
  private final static char []_jsp_string2;
  static {
    _jsp_string0 = "<!DOCTYPE html>\r\n<html>\r\n<head>\r\n	<meta charset=\"UTF-8\">\r\n	<title>CDR\u5feb\u67e5</title>\r\n	<link rel=\"stylesheet\" type=\"text/css\" href=\"jquery-easyui/themes/default/easyui.css\">\r\n	<link rel=\"stylesheet\" type=\"text/css\" href=\"jquery-easyui/themes/icon.css\">\r\n	<link rel=\"stylesheet\" type=\"text/css\" href=\"jquery-easyui/demo/demo.css\">\r\n	<script type=\"text/javascript\" src=\"jquery-easyui/jquery.min.js\"></script>\r\n	<script type=\"text/javascript\" src=\"js/jquery.easyui.min.js\"></script>\r\n	<script type=\"text/javascript\" src=\"jquery-easyui/locale/easyui-lang-zh_CN.js\"></script>\r\n	<script type=\"text/javascript\" src=\"js/highcharts.js\"></script>\r\n	<script type=\"text/javascript\" src=\"/clipcopy/ZeroClipboard.js\"></script>\r\n</head>\r\n<body style=\"padding:2px; margin:0px;\">\r\n  <div id='statinfo'></div>\r\n  <div id=\"divDatagrid1\" style=\"width:100%;height:100%\">\r\n		<table id=\"dg\" title=\"\" style=\"width:100%;height:630px;nowrap:false\" data-options=\"\r\n			toolbar:'#tb',\r\n			rownumbers:true,\r\n			singleSelect:true,\r\n			autoRowHeight:false,\r\n			remoteSort:false,\r\n			fitColumns :true, \r\n			pagination:true,\r\n			pageSize:50,\r\n			pageList:[50,100,500,1000],\r\n			onRowContextMenu: function(e, rowIndex, rowData) { \r\n			e.preventDefault();\r\n			$(this).datagrid('clearSelections');\r\n			$(this).datagrid('selectRow', rowIndex); \r\n			  $('#table_menu').menu('show', {\r\n				//\u663e\u793a\u53f3\u952e\u83dc\u5355\r\n				left: e.pageX,//\u5728\u9f20\u6807\u70b9\u51fb\u5904\u663e\u793a\u83dc\u5355\r\n				top: e.pageY\r\n			});\r\n		},			\r\n		onDblClickCell:function(rowIndex, field, value){\r\n			showSelectedRowDetail();\r\n		 }\r\n		\">\r\n\r\n		</table>\r\n	</div>	\r\n<div id=\"table_menu\" class=\"easyui-menu\" style=\"width: 50px; display: none;\">\r\n    <!--\u653e\u7f6e\u4e00\u4e2a\u9690\u85cf\u7684\u83dc\u5355Div-->\r\n    <div data-options=\"iconCls:'icon-save'\" onClick=\"onExportData()\">\u5bfc\u51fa</div>\r\n    <!--\u5177\u4f53\u7684\u83dc\u5355\u4e8b\u4ef6\u8bf7\u81ea\u884c\u6dfb\u52a0\uff0c\u8ddftoolbar\u7684\u65b9\u6cd5\u662f\u57fa\u672c\u4e00\u6837\u7684-->\r\n</div>	\r\n    <!--table\u7684toolbar-->\r\n<div id=\"tb\" style=\"padding:2px 5px;\">\r\n		\u9009\u62e9\u65e5\u5fd7\u7c7b\u578b\uff1a<input class=\"easyui-combobox\" id=\"cdrtype\" name=\"cdrtype\" style=\"width:200px;height:28px\" value=\"CS_MLTE_S1U_HTTP\" data-options=\"url:'cs_cdr_list.json',method:'get',valueField:'value',textField:'text',onSelect:onSelCdrType\">\r\n		\u5f00\u59cb\u65f6\u95f4\uff1a<input id=\"st\" class=\"easyui-datetimebox\" required style=\"width:146px;height:28px\">\r\n		\u7ed3\u675f\u65f6\u95f4\uff1a<input id=\"et\" class=\"easyui-datetimebox\"  required style=\"width:146px;height:28px\">\r\n        \u67e5\u8be2\u53f7\u7801\uff1a<input id=\"msisdn\" class=\"easyui-textbox\"  style=\"width:260px;height:28px\" data-options=\"prompt: '\u8bf7\u8f93\u5165\u9700\u8981\u67e5\u8be2\u7684\u5185\u5bb9,\u9017\u53f7\u5206\u9694!'\">\r\n		<a href=\"#\" class=\"easyui-linkbutton\" iconCls=\"icon-search\" onClick=\"onSearch()\">\u67e5\u8be2</a>&nbsp;&nbsp;\r\n		<a href=\"#\" class=\"easyui-linkbutton\"  onClick=\"onSearchRecent(-2)\">\u67e5\u8fd1\u4e24\u5929</a>\r\n		<a href=\"#\" class=\"easyui-linkbutton\"  onClick=\"onSearchRecent(-3)\">\u67e5\u8fd1\u4e09\u5929</a>\r\n		<a href=\"#\" class=\"easyui-linkbutton\"  onClick=\"onSearchRecent(-7)\">\u67e5\u8fd1\u4e00\u5468</a>\r\n		<a href=\"#\" class=\"easyui-linkbutton\"  onClick=\"onSearchRecent(-30)\">\u67e5\u8fd1\u4e00\u6708</a>\r\n</div>\r\n\r\n<!--\u8be6\u5355\u4fe1\u606f\u5f39\u51fa\u7a97\u53e3-->\r\n<div id=\"xdr_detail_dlg\" class=\"easyui-dialog\" title=\"XDR\u8be6\u5355\u4fe1\u606f\"  closed=\"true\" data-options=\"iconCls:'icon-man'\" style=\"width:744px;height:360px;padding:0px;\">\r\n</div>\r\n\r\n<!--\u7edf\u8ba1\u6570\u636e\u5f39\u51fa\u7a97\u53e3-->\r\n<div id=\"stat_dg_div\" class=\"easyui-dialog\" title=\"\u7edf\u8ba1\u4fe1\u606f\"  closed=\"true\" data-options=\"iconCls:'icon-man'\" style=\"width:930px;height:440px;padding:0px;\">\r\n<table><tr><td>\r\n	<table id='stat_dg' class=\"easyui-datagrid\" style=\"width:500px;height:398px;nowrap:false\"\r\n			data-options=\"singleSelect:true,collapsible:false,toolbar: '#stat_tb',\r\n				multiSort:false,remoteSort:false,fitColumns:false\">\r\n	</table>\r\n<textarea style=\"display:none\" id=\"tableContext2copy\">hello world</textarea>\r\n</td>\r\n<td>\r\n<div style=\" text-align:center\">x\u5750\u6807:\r\n	<input class=\"easyui-combobox\" id=\"chart_x\" name=\"chart_x\" style=\"width:120px\" data-options=\"valueField:'id',textField:'text',onSelect:onChartXChange,onUnselect:onChartXChange\">&nbsp;&nbsp;&nbsp;&nbsp;y\u5750\u6807:\r\n	<input class=\"easyui-combobox\" id=\"chart_y\" name=\"chart_y\" style=\"width:120px\" data-options=\"valueField:'id',textField:'text',multiple:false,onSelect:onChartYChange,onUnselect:onChartYChange\">\r\n </div>\r\n<div id=\"chart_container\" style=\"min-width:400px;height:360px\"></div>\r\n</td></tr>\r\n</table>\r\n</div>\r\n<div id=\"stat_tb\" style=\"height:auto\">\r\nSUM:<input 	id=\"ct_sum\"\r\n			class=\"easyui-combobox\" \r\n			style=\"width:120px;\"\r\n			name=\"ct_sum\"\r\n			data-options=\"\r\n					valueField:'id',\r\n					textField:'text',\r\n					multiple:true,\r\n					panelHeight:'auto'\r\n			\">\r\nGROUP BY:<input 	id=\"ct_groupby\"\r\n			class=\"easyui-combobox\" \r\n			name=\"ct_groupby\"\r\n			style=\"width:120px;\"\r\n			data-options=\"\r\n					valueField:'id',\r\n					textField:'text',\r\n					multiple:true,\r\n					panelHeight:'auto'\r\n			\">\r\n<a href=\"#\" class=\"easyui-linkbutton\" iconCls=\"icon-chart-line\"  onClick=\"onStat()\">\u7edf\u8ba1</a>&nbsp;&nbsp;\r\n<a id=\"copy2clip_btn\" href=\"javascript:void(0)\" class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-cut',plain:true\" data-clipboard-target=\"tableContext2copy\" onClick=\"updateStatTableContent()\">to\u526a\u8d34\u677f</a>\r\n</div>\r\n	\r\n</body>\r\n<script language=\"javascript\">\r\n//\u4fdd\u5b58\u5f53\u524d\u8868\u7684\u6240\u6709\u4fe1\u606f\uff0c\u5305\u62ec\u6570\u636e\u6e90\uff0c\u5217\u540d\uff0c\u663e\u793a\u540d\uff0c\u6bcf\u5217\u7684\u957f\u5ea6\u7b49\r\nvar tHeader=[];\r\n//\u7f13\u5b58\u5f53\u524d\u67e5\u8be2\u8fd4\u56de\u7684\u6240\u6709\u7ed3\u679c\r\nvar tData=[];\r\n//\u7f13\u5b58\u7edf\u8ba1\u540e\u7684\u7ed3\u679c\r\nvar sData=[];	\r\n//\u7f13\u5b58\u67e5\u8be2\u6761\u4ef6\u7684\u5f00\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\r\nvar sDate,eDate;\r\n//\u4fdd\u5b58\u5f53\u524d\u591a\u7ef4\u7edf\u8ba1\u8868\u7684\u8868\u5934\uff0c\u4e0d\u5305\u542b\u9690\u85cf\u7684\u90e8\u5206\r\nvar sHeader=[];\r\n\r\n//-----------------------------------\u997c\u56fe\u76f8\u5173-------------------------------------------\r\n//\u5f53x\u5750\u6807\u53d1\u751f\u6539\u53d8\u65f6\u8c03\u7528\r\nfunction onChartXChange()\r\n{\r\n	onUpdateChartPie();\r\n	//alert(idx);\r\n}\r\n//\u5f53y\u5750\u6807\u53d1\u751f\u6539\u53d8\u65f6\u8c03\u7528\r\nfunction onChartYChange()\r\n{\r\n	onUpdateChartPie();\r\n}\r\n\r\n//\u5f53\u5750\u6807\u9009\u62e9\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u91cd\u65b0\u7edf\u8ba1\u6570\u636e\u5e76\u66f4\u65b0\u997c\u56fe\r\nfunction onUpdateChartPie()\r\n{\r\n	var x=$('#chart_x').combobox('getValue')\r\n	var y=$('#chart_y').combobox('getValue')\r\n	if(!x||!y)\r\n	{\r\n		return;\r\n	}\r\n	var series=getChartStatData(x,y);\r\n	\r\n	$(function () {\r\n    $('#chart_container').highcharts({\r\n        chart: {\r\n            plotBackgroundColor: null,\r\n            plotBorderWidth: null,\r\n            plotShadow: false\r\n        },\r\n        title: {\r\n            text: 'Top 10\u5360\u6bd4\u7edf\u8ba1'\r\n        },\r\n        tooltip: {\r\n    	    pointFormat: '{series.name}: <b>{point.percentage:.2f}%</b>'\r\n        },\r\n        plotOptions: {\r\n            pie: {\r\n                allowPointSelect: true,\r\n                cursor: 'pointer',\r\n                dataLabels: {\r\n                    enabled: true,\r\n                    color: '#000000',\r\n                    connectorColor: '#000000',\r\n                    format: '<b>{point.name}</b>: {point.percentage:.2f} %'\r\n                }\r\n            }\r\n        },\r\n        series: [series]\r\n    });\r\n});\r\n\r\n\r\n}\r\n\r\n//\u6839\u636e\u9009\u62e9\u7684x\uff0cy\u5750\u6807\uff0c\u6765\u7edf\u8ba1x\u7eac\u5ea6\u7684\u6307\u6807y\r\nfunction getChartStatData(x,y)\r\n{\r\n	var xfield=tHeader.columns[x].field;\r\n	var yfield=tHeader.columns[y].field;\r\n	var chartData=[];\r\n	for(i in tData)\r\n	{\r\n		var obj=new Object();\r\n		obj.key=tData[i][xfield];\r\n		obj.value=parseInt(tData[i][yfield]);\r\n		statChartData(chartData,obj);\r\n	}\r\n	var cd=getPieChartSeries(chartData);\r\n	return cd;\r\n}\r\nfunction statChartData(chartStatData,obj)\r\n{\r\n		for(j in chartStatData)\r\n		{\r\n			var cObj=chartStatData[j];\r\n			if(cObj.key==obj.key)\r\n			{\r\n				cObj.value+=obj.value;\r\n				return;\r\n			}\r\n		}\r\n		chartStatData.push(obj);\r\n}\r\n\r\n//\u751f\u6210\u524d\u5341\u7684\u997c\u56fe\u6570\u636e\r\nfunction getPieChartSeries(statData)\r\n{\r\n	sortStatData(statData);\r\n	var len=statData.length;\r\n	if(len>10)\r\n		len=10;\r\n\r\n	var ss=new Object();\r\n	ss.type='pie';\r\n	ss.name='\u5360\u6bd4';\r\n	var data=[];\r\n	for(var i=0;i<len;i++)\r\n	{\r\n		var dataitem=[];\r\n		dataitem.push(statData[i].key);\r\n		dataitem.push(statData[i].value);\r\n		data.push(dataitem);\r\n	}\r\n	ss.data=data;\r\n	return ss;\r\n}\r\n//\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u964d\u5e8f\r\nfunction sortStatData(statData) {\r\n    var i = 0,\r\n    len = statData.length,\r\n    j, d;\r\n    for (; i < len; i++) {\r\n        for (j = 0; j < len; j++) {\r\n            if (statData[i].value > statData[j].value) {\r\n                d = statData[j];\r\n                statData[j] = statData[i];\r\n                statData[i] = d;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n// \u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u590d\u5236\u5bf9\u8c61\r\nvar clipCopy = new ZeroClipboard( document.getElementById(\"copy2clip_btn\"), {\r\n  moviePath: \"/clipcopy/ZeroClipboard.swf\"\r\n} );\r\n\r\n// \u590d\u5236\u5185\u5bb9\u5230\u526a\u8d34\u677f\u6210\u529f\u540e\u7684\u64cd\u4f5c\r\nclipCopy.on( 'complete', function(client, args) {\r\n   alert(\"\u8868\u683c\u5df2\u590d\u5236\uff0c\u4f60\u53ef\u4ee5\u7c98\u8d34\u5230\u8bb0\u4e8b\u672c\u4e2d\u4f7f\u7528\uff01\");\r\n} );\r\n\r\n\r\nfunction onSearch()\r\n{\r\n	var val = $('#msisdn').textbox('getValue');\r\n	var st=$('#st').datetimebox('getValue');\r\n	var et=$('#et').datetimebox('getValue');\r\n	var target_table=$('#cdrtype')".toCharArray();
    _jsp_string1 = ".combobox('getValue');	\r\n	if(!target_table||isNaN(val)||!val||!st||!et)\r\n	{\r\n		alert('\u8f93\u5165\u9519\u8bef\uff0cCDR\u7c7b\u578b\u3001\u5f00\u59cb\u7ed3\u675f\u65f6\u95f4\u3001\u67e5\u8be2\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u6216\u53f7\u7801\u5fc5\u987b\u4e3a\u6570\u5b57\uff01');\r\n		return;\r\n	}\r\n	sDate=new Date(st.replace(/-/g,'/'));\r\n	eDate=new Date(et.replace(/-/g,'/'));\r\n	var ts1 = Date.parse(sDate);\r\n	var ts2 = Date.parse(eDate);\r\n\r\n	if(ts1>ts2)\r\n	{\r\n		alert('\u8f93\u5165\u9519\u8bef\uff0c\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65f6\u95f4\uff01');\r\n		return;\r\n	}\r\n\r\n//	alert('target_table:'+target_table+'\\rstarttime:'+ts1+'\\rendtime:'+ts2+'\\rval:'+val);\r\n	onQuery(target_table,val,ts1,ts2);		\r\n}\r\n//\u65e5\u671f\u589e\u51cf\u51fd\u6570\r\nfunction addDate(daynow,day2add){\r\n	var a = new Date(daynow);\r\n	a = a.valueOf();\r\n	a = a + day2add * 24 * 60 * 60 * 1000;\r\n	a = new Date(a);\r\n	return a;\r\n}\r\n\r\n\r\n//\u5f53\u70b9\u51fb\u67e5\u8be2\u6700\u8fd1\u51e0\u5929\u7684\u6309\u94ae\u65f6\u89e6\u53d1\r\nfunction onSearchRecent(d)\r\n{\r\n	var msisdn = $('#msisdn').textbox('getValue');\r\n	var target_table=$('#cdrtype').combobox('getValue');	\r\n	if(isNaN(msisdn)||!msisdn)\r\n	{\r\n		alert(\"\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01\");\r\n		return;\r\n	}\r\n	eDate = new Date();\r\n	sDate=addDate(eDate,d);\r\n//	alert(eDate.valueOf()+\"\\r\"+sDate.valueOf());\r\n	onQuery(target_table,msisdn,sDate.valueOf(),eDate.valueOf());	\r\n}\r\n//-------------------------------------\u591a\u7ef4\u5206\u6790\u8868\u683c\u76f8\u5173\u65b9\u6cd5--------------------------\r\n//\u5f53\u70b9\u51fb\u591a\u7ef4\u67e5\u8be2\u4e2d\u7684\u7edf\u8ba1\u6309\u94ae\u65f6\uff0c\u6839\u636e\u9009\u62e9\u7684\u7eac\u5ea6\u548c\u7edf\u8ba1\u7684\u6307\u6807\u8fdb\u884c\u7edf\u8ba1\r\nfunction onStat()\r\n{\r\n	var sum_idx=$('#ct_sum').combobox('getValues');//array\r\n	var groupby_idx=$('#ct_groupby').combobox('getValues');//array\r\n//	alert(sum_idx+\"\\r\"+groupby_idx);\r\n	if(sum_idx.length==0||groupby_idx.length==0)\r\n	{\r\n		alert('\u7edf\u8ba1\u6761\u4ef6\u4e0d\u80fd\u4e3a\u7a7a\uff01');\r\n		return;\r\n	}\r\n	//reset\u591a\u7ef4\u5206\u6790\u754c\u9762\u4e2d\u7684\u8868\u683c\uff0c\u548c\u997c\u56fe\u76f8\u5173\u7ec4\u4ef6\r\n	resetStatTable();\r\n	$('#chart_x').combobox('clear');\r\n	$('#chart_y').combobox('clear');\r\n	initChartCombobox($('#chart_x'),groupby_idx,tHeader);\r\n	initChartCombobox($('#chart_y'),sum_idx,tHeader);\r\n\r\n	stat(sum_idx,groupby_idx);\r\n\r\n	\r\n}\r\n\r\nfunction initChartCombobox(chart,ids,headers)\r\n{\r\n	var ccArray=[];\r\n	for(i in ids)\r\n	{\r\n		var obj=new Object();\r\n		obj.id=ids[i];\r\n		obj.text=headers.columns[obj.id].title;\r\n		ccArray.push(obj);\r\n	}\r\n	chart.combobox('loadData', ccArray);\r\n}\r\n\r\nfunction isHiddenColumn(id, not_hide_arr)\r\n{\r\n	//alert(\"isHiddenColumn==>\"+id+\"==>\");\r\n	for(i in not_hide_arr)\r\n	{\r\n		if(id==not_hide_arr[i])\r\n			return false;\r\n	}\r\n	return true;\r\n		\r\n}\r\n\r\n//\u8f93\u5165\u9700\u8981sum\u7684\u5217\u548c\u9700\u8981group by\u7684\u5217\r\nfunction stat(sum_idx,gb_idx)\r\n{\r\n	var gbFields=[];\r\n	var sumFields=[];\r\n	//\u591a\u7ef4\u5206\u6790\u8868\u683c\u4e2d\u663e\u793a\u7684\u8868\u5934\u96c6\u5408\uff0c\u5305\u542b\u9690\u85cf\u7684\u5b57\u6bb5\r\n	var statTableHeader=[];\r\n	sHeader=[];\r\n	\r\n	for(i in gb_idx)\r\n	{\r\n		gbFields.push(tHeader.columns[gb_idx[i]].field);\r\n		sHeader.push(tHeader.columns[gb_idx[i]].field);\r\n		var hObj=new Object();\r\n		hObj.title=tHeader.columns[gb_idx[i]].title;\r\n		hObj.field=tHeader.columns[gb_idx[i]].field;\r\n		hObj.width=tHeader.columns[gb_idx[i]].width;\r\n		statTableHeader.push(hObj);\r\n	}\r\n	for(i in sum_idx)\r\n	{\r\n		sHeader.push(tHeader.columns[sum_idx[i]].field);\r\n	}\r\n	//sum_idx_2\u662f\u5168\u8868\u4e2d\u53ef\u8ba1\u7b97\u7684\u5b57\u6bb5\u7684\u96c6\u5408\uff0c\u56e0\u4e3ajquery\u7684\u8868\u683c\u70b9\u51fb\u6392\u5e8f\u540e\uff0c\u91cd\u65b0loaddata\u4f1a\u6709\u95ee\u9898\uff0c\u5fc5\u987b\u5e26\u4e0a\u6392\u5e8f\u540e\u7684\u5b57\u6bb5\u624d\u80fd\u663e\u793a\u6b63\u5e38\uff0c\u56e0\u6b64\u53ea\u80fd\u5c06\u6392\u5e8f\u540e\u7684\u5b57\u6bb5\u9690\u85cf\u4e86\r\n	var sum_idx_2=[];\r\n	for(i in tHeader.columns)\r\n	{\r\n		if(tHeader.columns[i].sum)\r\n			sum_idx_2.push(i);\r\n	}\r\n\r\n	for(i in sum_idx_2)//\u6240\u6709\u7edf\u8ba1\u7684\u6570\u636e\u90fd\u53ef\u4ee5\u6392\u5e8f\r\n	{\r\n	\r\n		sumFields.push(tHeader.columns[sum_idx_2[i]].field);\r\n		var hObj=new Object();\r\n		hObj.title=\"SUM(\"+tHeader.columns[sum_idx_2[i]].title+\")\";\r\n		hObj.field=tHeader.columns[sum_idx_2[i]].field;\r\n		hObj.width=tHeader.columns[sum_idx_2[i]].width+30;\r\n		hObj.sortable=true;\r\n		if(isHiddenColumn(sum_idx_2[i],sum_idx))\r\n		{// alert(\"hidden\");\r\n		   hObj.hidden=true;\r\n		  \r\n		 }\r\n		 else\r\n		 {//alert(\"not hidden\");\r\n		   hObj.hidden=false;\r\n		   \r\n			}\r\n		statTableHeader.push(hObj);\r\n	}\r\n	\r\n	sData=[];//\u6e05\u7a7a\u4e0a\u6b21\u7edf\u8ba1\u7684\u7f13\u5b58\r\n	for(i in tData)//\u904d\u5386\u8868\u4e2d\u6240\u6709\u7684\u6570\u636e\r\n	{\r\n		var obj=new Object();\r\n		obj.sum=[];\r\n		obj.groupby=[]\r\n		for(j in sumFields)\r\n		{\r\n			var sumf=sumFields[j];\r\n			obj.sum.push(parseInt(tData[i][sumf]));\r\n			\r\n		}\r\n		for(k in gbFields)\r\n		{\r\n			var gbf=gbFields[k];\r\n			obj.groupby.push(tData[i][gbf]);\r\n		}\r\n		performSumStat(obj);\r\n	}\r\n	\r\n\r\n	//\u5c06sData\u4e2d\u7684\u7edf\u8ba1\u6570\u636e\u53d8\u6362\u6210datagrid\u80fd\u591f\u8bfb\u53d6\u7684json\u683c\u5f0f\r\n	var data=constructStatTableData(gbFields,sumFields);\r\n//	resetStatTable();\r\n	\r\n	//\u53d8\u6362\u8868\u683c\u7684\u8868\u5934\r\n	$('#stat_dg').datagrid({\r\n		columns:[statTableHeader]\r\n	});	\r\n	//alert(\"data ==>\"+data.rows.length);\r\n\r\n	//\u52a0\u8f7d\u7edf\u8ba1\u6570\u636e\r\n	$('#stat_dg').datagrid('loadData', data);\r\n\r\n	//\u66f4\u65b0\u526a\u8d34\u677f\u6570\u636e\r\n	updateStatTableContent();\r\n	\r\n}\r\n\r\n	//\u5c06sData\u4e2d\u7684\u7edf\u8ba1\u6570\u636e\u53d8\u6362\u6210datagrid\u80fd\u591f\u8bfb\u53d6\u7684json\u683c\u5f0f\r\nfunction constructStatTableData(gbf,sumf)\r\n{\r\n	var data=new Object();\r\n	data.total=sData.length;\r\n	\r\n	var rows=[];\r\n	//alert(gbf.join(\",\"));\r\n	//alert(sumf.join(\",\"));\r\n	for(i in sData)\r\n	{\r\n		var sum=sData[i].sum;//\u6570\u7ec4\r\n		//alert(sum.join(\",\"));\r\n\r\n		var gb=sData[i].groupby;//\u6570\u7ec4\r\n		//	alert(gb.join(\",\"));\r\n		var it=new Object();\r\n		for(j in gbf)\r\n		{\r\n			//alert(gbf[j]+\"\\r\"+gb[j]);\r\n			it[gbf[j]]=gb[j];\r\n		}\r\n		for(j in sumf)\r\n		{\r\n		//alert(sumf[j]+\"\\r\"+sum[j]);\r\n			it[sumf[j]]=sum[j];\r\n		}\r\n	//	alert(it.MSISDN+\"\\r\"+it.DL_DATA);\r\n		rows.push(it);\r\n	}\r\n	data.rows=rows;\r\n	return data;\r\n}\r\n\r\nfunction onShowStatTable()\r\n{\r\n	var cSumTree=[];	\r\n	var cGroupByTree=[];\r\n	for(i in tHeader.columns)\r\n	{\r\n		var citem=new Object();\r\n		citem.id=i;\r\n		citem.text=tHeader.columns[i].title;\r\n		//citem.iconCls=\"icon-none\";\r\n		\r\n		\r\n		if(tHeader.columns[i].sum)//\u53ef\u8ba1\u7b97\u7684\r\n			cSumTree.push(citem);\r\n		else \r\n		{\r\n			if(tHeader.columns[i].groupby)//\u53ef\u8ba1\u7b97\u7684\r\n				cGroupByTree.push(citem);\r\n		}\r\n			\r\n	}\r\n	$('#ct_sum').combobox('loadData', cSumTree);\r\n	$('#ct_groupby').combobox('loadData', cGroupByTree);\r\n\r\n\r\n	//\u6253\u5f00\u591a\u7ef4\u7edf\u8ba1\u9762\u677f\r\n	$('#stat_dg_div').dialog('open');\r\n	\r\n\r\n}	\r\n\r\n\r\n\r\nfunction performSumStat(obj)\r\n{\r\n	for(i in sData)\r\n	{\r\n		var sObj=sData[i];\r\n		var isFound=true;\r\n		for(j in sObj.groupby)\r\n		{\r\n			if(obj.groupby[j]!=sObj.groupby[j])\r\n			{\r\n				isFound=false;\r\n				break;\r\n			}\r\n		}\r\n		\r\n		if(isFound)//\u5982\u679c\u8be5\u7eac\u5ea6\u5df2\u6709\u7edf\u8ba1\r\n		{\r\n			for(j in sObj.sum)\r\n			{\r\n				sObj.sum[j]+=obj.sum[j];//\u7d2f\u8ba1\r\n			}\r\n			return ;\r\n		}\r\n\r\n	}\r\n	\r\n	//\u5982\u679c\u6ca1\u6709\u627e\u5230\r\n	sData.push(obj);\r\n}\r\n\r\nfunction getNotHiddenColumns()\r\n{\r\n	var opts = $('#stat_dg').datagrid('getColumnFields'); //\u8fd9\u662f\u83b7\u53d6\u5230\u6240\u6709\u7684FIELD\r\n	var hidden=[];\r\n	for(i=0;i<opts.length;i++)\r\n	{\r\n		var col = $('#stat_dg').datagrid( \"getColumnOption\" , opts[i] );\r\n		if(!col.hidden)\r\n			hidden.push(i);\r\n	}\r\n	return hidden;\r\n}\r\n\r\nfunction updateStatTableContent()\r\n{\r\n	//alert(\"update table content\");\r\n	var rows = $(\"#stat_dg\").datagrid(\"getRows\");	\r\n	var tableContent=\"\";\r\n	for(i in rows)\r\n	{\r\n		var row=rows[i];\r\n		for(j in sHeader)\r\n		{\r\n			tableContent+=row[sHeader[j]]+\",\";\r\n		}\r\n		tableContent=tableContent.substring(0,tableContent.length-1);\r\n		tableContent+=\"\\r\\n\";\r\n	}\r\n	\r\n	document.getElementById(\"tableContext2copy\").value=tableContent;\r\n//	alert(document.getElementById(\"tableContext2copy\").value);\r\n	\r\n}\r\n\r\n//\u521d\u59cb\u5316\u7ec4\u4ef6\u7684\u72b6\u6001\uff0c\u901a\u5e38\u5728\u91cd\u65b0\u70b9\u51fb\u67e5\u8be2\u540e\u8981\u521d\u59cb\u5316\r\nfunction resetOnReQuery()\r\n{\r\n	$('#ct_groupby').combobox('clear');\r\n	$('#ct_sum').combobox('clear');\r\n	$('#chart_x').combobox('clear');\r\n	$('#chart_y').combobox('clear');\r\n	resetStatTable();\r\n}\r\nfunction resetStatTable()\r\n{\r\n	$('#stat_dg').datagrid({\r\n		columns:[]\r\n	});	\r\n	$('#stat_dg').datagrid('loadData', { total: 0, rows: [] });\r\n}\r\n\r\nfunction showSelectedRowDetail()\r\n{\r\n	var row = $('#dg').datagrid('getSelected');\r\n	if (row){\r\n	var htmlstr=\"<table style='width:710px;border:0px;padding:0px;word-break:break-all; word-wrap:break-all;'>\";\r\n	for(var i=0;i<tHeader.columns.length;i++)\r\n	{\r\n		if(i%2==0)\r\n			htmlstr+=\"<tr  bgcolor='#f4f4f4'><td width='100px' border=1><strong>\"+tHeader.columns[i].title+\"</strong></td><td>\"+row[tHeader.columns[i].field]+\"</td></tr>\";\r\n		else\r\n			htmlstr+=\"<tr  bgcolor='#f9f9f9'><td width='100px'  border=1><strong>\"+tHeader.columns[i].title+\"</strong></td><td>\"+row[tHeader.columns[i].field]+\"</td></tr>\";\r\n	}\r\n	htmlstr+=\"</table>\";\r\n	document.getElementById(\"xdr_detail_dlg\").innerHTML=htmlstr;\r\n	}\r\n	$('#xdr_detail_dlg').dialog('open');\r\n}\r\n\r\n\r\nfunction onSelCdrType()\r\n{\r\n	var cdr_table_meta_url=\"cdr_table_meta/\"+$('#cdrtype').combobox('getValue')+\".json\";\r\n	$.ajax({\r\n		type: \"post\",\r\n		dataType: \"json\",\r\n		url:cdr_table_meta_url,\r\n		success: function (data) {\r\n			//alert(data.xdrName);\r\n			tHeader=data;\r\n		},\r\n		failure:function (data) {  \r\n		alert('Failed to get table metadata!');  \r\n		//ajaxLoadEnd();\r\n		 }\r\n	});\r\n}\r\n\r\n\r\n\r\n\r\n		\r\nfunction pagerFilter(data){\r\n	if (typeof data.length == 'number' && typeof data.splice == 'function'){	// is array\r\n		data = {\r\n			total: data.length,\r\n			rows: data\r\n		}\r\n	}\r\n	var dg = $(thi".toCharArray();
    _jsp_string2 = "s);\r\n	var opts = dg.datagrid('options');\r\n	var pager = dg.datagrid('getPager');\r\n	pager.pagination({\r\n		onSelectPage:function(pageNum, pageSize){\r\n			opts.pageNumber = pageNum; \r\n			opts.pageSize = pageSize;\r\n			\r\n			pager.pagination('refresh',{\r\n				pageNumber:pageNum,\r\n				pageSize:pageSize\r\n			});\r\n			dg.datagrid('loadData',data);\r\n		},\r\n		buttons:[{\r\n			iconCls:'icon-chart-bar',\r\n			handler:onShowStatTable\r\n		}]\r\n	});\r\n	if (!data.originalRows){\r\n		data.originalRows = (data.rows);\r\n	}\r\n	var start = (opts.pageNumber-1)*parseInt(opts.pageSize);\r\n	var end = start + parseInt(opts.pageSize);\r\n	data.rows = (data.originalRows.slice(start, end));\r\n	\r\n	return data;\r\n}\r\n		\r\nfunction onQuery(tn,val,st,et)\r\n{\r\n	resetOnReQuery();\r\n	//\u663e\u793a\u8868\u683c\u7684\u8868\u5934\r\n	$('#dg').datagrid({\r\n		columns:[tHeader.columns]\r\n	});	\r\n	var apiUrl=tHeader.apiUrl;\r\n	var fieldList=tHeader.fieldList;\r\n	var params={msisdn:val,tn:tn,st:st,et:et,fieldList:fieldList,rtype:\"json\"};\r\n\r\n	//alert('===>target_table:'+tn+'\\rstarttime:'+st+'\\rendtime:'+et+'\\ridx:'+idx+'\\rval:'+val);\r\n	//\u901a\u8fc7ajax\u5f02\u6b65\u8bfb\u53d6cdr\u67e5\u8be2\u63a5\u53e3\u6570\u636e\r\n	 $.ajax({\r\n			type: \"post\",\r\n			dataType: \"json\",\r\n		  // url: \"/cube/cdrquery\",\r\n			url:apiUrl,\r\n			data:params,\r\n			beforeSend:ajaxLoading,\r\n			success: function (data) {\r\n				var str = \"\";\r\n				tData = data;//\u6570\u7ec4\uff0c\u4fdd\u5b58\u4e86\u8fd4\u56de\u7684\u6240\u6709\u7ed3\u679c\r\n				ajaxLoadEnd();\r\n				//\u52a0\u8f7d\u6570\u636e\u5230\u8868\u683c\u4e2d\r\n				$('#dg').datagrid({loadFilter:pagerFilter}).datagrid('loadData', data);\r\n		\r\n			},\r\n			failure:function (data) {  \r\n			alert('Failed');  \r\n			ajaxLoadEnd();\r\n			}\r\n		});\r\n		\r\n}\r\n				\r\n//table\u6570\u636e\u52a0\u8f7d\u65f6\u8c03\u7528				\r\nfunction ajaxLoading(){ \r\n	$(\"<div class=\\\"datagrid-mask\\\"></div>\").css({display:\"block\",width:\"100%\",height:$(window).height()}).appendTo(\"body\"); \r\n	$(\"<div class=\\\"datagrid-mask-msg\\\"></div>\").html(\"\u6b63\u5728\u5904\u7406\uff0c\u8bf7\u7a0d\u5019...\").appendTo(\"body\").css({display:\"block\",left:($(document.body).outerWidth(true) - 100) / 2,top:($(window).height() - 45) / 2}); \r\n} \r\n//table\u6570\u636e\u52a0\u8f7d\u7ed3\u675f\u540e\u8c03\u7528\r\nfunction ajaxLoadEnd(){ \r\n	 $(\".datagrid-mask\").remove(); \r\n	 $(\".datagrid-mask-msg\").remove();             \r\n} \r\n\r\nfunction showBrieftStatInfo()\r\n{\r\n	var info='';\r\n	var t_dldata=0;\r\n	var t_uldata=0;\r\n	for(var i=0;i<sData.length;i++)\r\n	{\r\n		t_dldata+=sData[i].dldata;\r\n		t_uldata+=sData[i].uldata;\r\n	}\r\n	t_dldata=t_dldata/1024/1024;\r\n	t_uldata=t_uldata/1024/1024;\r\n	info=\"\u8be5\u7528\u6237\u5728\u3010<font color=blue>\"+sDate.toLocaleString()+\"</font> \u81f3 <font color=blue>\"+eDate.toLocaleString()+\"</font>\u3011\u671f\u95f4\u4ea7\u751f\u7684\u4e0a\u884c\u6d41\u91cf\u4e3a:<font color=red>\"+t_uldata.toFixed(2)+\"</font>(MB), \u4e0b\u884c\u6d41\u91cf\u4e3a:<font color=red>\"+t_dldata.toFixed(2)+\"</font>(MB)\";	\r\n	document.getElementById(\"statinfo\").innerHTML=info;\r\n}\r\n\r\n	\r\n$(function(){\r\n	onSelCdrType();//\u52a0\u8f7d\u9ed8\u8ba4\u9009\u53d6\u7684cdr\u7c7b\u578b\u7684\u8868\u5934\r\n	\r\n	var pager = $('#dg').datagrid().datagrid('getPager');	// get the pager of datagrid\r\n	pager.pagination({\r\n		buttons:[{\r\n			iconCls:'icon-chart-bar',\r\n			handler:onShowStatTable\r\n		}]\r\n		});			\r\n});	\r\n</script>\r\n</html>".toCharArray();
  }
}
